@model StatoRequest
@using LoocERP.Controllers
<table id="list_request" class="table table-bordered table-hover">
    <thead>
        <tr class="rowclone">
            <th>Nome</th>
            <th>Mansioni richieste</th>
            <th>Specializzazioni richieste</th>
            <th>Azioni</th>
        </tr>
    </thead>
</table>
<style>
    table.table-bordered.dataTable tbody th, table.table-bordered.dataTable tbody td {
        padding: 10px !important;
    }
</style>

@using (Html.BeginScripts())
{
    <script>
        function sendRequest(row) {

        }
        function reload(stato) {
            $('#list_request').DataTable().clear();
            $('#list_request').DataTable().destroy();

            $('#list_request thead tr.rowclone:eq(1) th').each(function (i) {
                var title = $(this).text();
                if (!$(this).hasClass("hide-search")) {
                    $(this).html('<input type="text" placeholder="Cerca ' + title + '" />');
                    $('input', this).on('keyup change', function () {
                        if (table.column(i).search() !== this.value) {
                            table
                                .column(i)
                                .search(this.value)
                                .draw();
                        }
                    });
                }
            });

            var table = $('#list_request').DataTable({
                ajax: "/resourcerequest/ajaxIndex?stato=" + stato + "&selected=" + date_search,

                dom: 'Bifrtip',//dom: 'Bftp',
                buttons: [
                    'copyHtml5',
                    'excelHtml5',
                    'csvHtml5',
                    'pdfHtml5'
                ],
                "columns": [
                    { "data": "nome" },
                    { "data": "nMansioni" },
                    { "data": "nSpecializzazioni" },
                    {
                        "data": null,
                        "render": function (data, type, row) {

                            var txt = '<div class="row">';
                            if (stato == 0) {
                                txt += '<div class="col-4">';
                                txt += '<a href="/resourcerequest/edit?id=' + row.id + '"><i class="fas fa-edit"></i></a>';
                                txt += '</div>';
                                txt += '<div class="col-4">';
                                txt += '<a class="delete-btn"><i class="far fa-paper-plane"></i></a>';
                                txt += '</div>';
                                txt += '</div>';
                            }
                            if (stato > 0) {
                                txt += '<div class="col-4">';
                                txt += '<a href="/resourcerequest/edit?id=' + row.id + '"><i class="fas fa-eye"></i></a>';
                                txt += '</div>';
                                txt += '</div>';
                            }


                            return txt;
                        }
                    },
                ],
                "language": {
                    "sEmptyTable": "Nessun dato presente nella tabella",
                    "sInfo": "Vista da _START_ a _END_ di _TOTAL_ elementi",
                    "sInfoEmpty": "Vista da 0 a 0 di 0 elementi",
                    "sInfoFiltered": "(filtrati da _MAX_ elementi totali)",
                    "sInfoPostFix": "",
                    "sInfoThousands": ".",
                    "sLengthMenu": "Visualizza _MENU_ elementi",
                    "sLoadingRecords": "Caricamento...",
                    "sProcessing": "Elaborazione...",
                    "sSearch": "Cerca:",
                    "sZeroRecords": "La ricerca non ha portato alcun risultato.",
                    "oPaginate": {
                        "sFirst": "Inizio",
                        "sPrevious": "Precedente",
                        "sNext": "Successivo",
                        "sLast": "Fine"
                    },
                    "oAria": {
                        "sSortAscending": ": attiva per ordinare la colonna in ordine crescente",
                        "sSortDescending": ": attiva per ordinare la colonna in ordine decrescente"
                    }
                },
                initComplete: function () {
                    // Apply the search
                    this.api().columns().every(function () {
                        var that = this;
                        $('input', this.header()).on('keyup change clear', function () {
                            if (that.search() !== this.value) {
                                that
                                    .search(this.value)
                                    .draw();
                            }
                        });
                    });
                },
                "autoWidth": false,
                "responsive": true,
                orderCellsTop: true,
                fixedHeader: true
            }
            );
            $('#list_request').on('click', '.delete-btn', function () {
                let rrr = this;
                let rowData = $('#list_request').DataTable().row($(this).closest('tr')).data();

                let row = table.row($(rrr).parents('tr'));

                row.remove();

                table.draw();


                $.ajax({
                    url: '/resourcerequest/ajaxSetStato?Id=' + rowData.id + "&stato=1",
                    type: 'get',
                    success: function (data) {
                        let row = table.row($(rrr).parents('tr'));

                        row.remove();

                        table.draw();
                    }
                });

            });
        }

        function reloadTable(self, stato) {
            $("#tabs_list .active").removeClass("active");
            $(self).addClass("active");
            reload(stato);
        }
        $('#list_request thead tr').clone(true).appendTo('#list_request thead');
        reload(0);

    </script>
    <script src="~/theme/plugins/jquery-knob/jquery.knob.min.js"></script>
}