@{
    DateTime today = DateTime.Now.Date;
    string todaystring = @today.Year + "-" + @today.Month.ToString("0#") + "-" + @today.Day.ToString("0#");
}

<div class="card card-primary">
    <div class="card-body">
        <div class="col-12">
            <div class="row">
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Richiesta del:</label>
                        <div class="col-xs-12">
                            <div class="input-group">
                                <div class="form-group col-12">
                                    <input type="date" value="@todaystring" id="dateSearch" data-date="" data-date-format="DD-MM-YYYY" class="form-control" name="EndDate" placeholder="Data di consegna" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="charts" class="col-12 col-sm-8">
                    <div class="col-12">
                        <div class="row" id="chartsList">
                            <div class="col-6 col-md-4 text-center">
                                Richieste totali :<br>
                                <label id="totRichieste" style="font-size: 50px;">0</label>
                            </div>
                            <div class="col-md-8 row">
                                <div class="col-6 col-md-3 text-center">
                                    <input type="text" class="knob" value="0" data-width="90" data-height="90" data-fgColor="#3c8dbc"
                                           data-readonly="true"
                                           id="bozze_rep">
                                    <div class="knob-label">Bozze</div>
                                </div>
                                <div class="col-6 col-md-3 text-center">
                                    <input type="text" class="knob" value="0" data-width="90" data-height="90" data-fgColor="#3c8dbc"
                                           data-readonly="true"
                                           id="sent_rep">
                                    <div class="knob-label">Inviate</div>
                                </div>
                                <div class="col-6 col-md-3 text-center">
                                    <input type="text" class="knob" value="0" data-width="90" data-height="90" data-fgColor="#3c8dbc"
                                           data-readonly="true"
                                           id="incarico_rep">
                                    <div class="knob-label">In Carico</div>
                                </div>
                                <div class="col-6 col-md-3 text-center">
                                    <input type="text" class="knob" value="0" data-width="90" data-height="90" data-fgColor="#3c8dbc"
                                           data-readonly="true"
                                           id="comple_rep">
                                    <div class="knob-label">Completate</div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="card col-12 p-0">
    <div class="card-body">
        <a class="btn-sm" href="/resourcerequest/edit">
            <i class="fa fa-plus" aria-hidden="true"></i> Crea nuova <b>RICHIESTA</b>
        </a>
    </div>
</div>

<script src="~/theme/plugins/jquery-knob/jquery.knob.min.js"></script>
<script>

    var date_search = '@todaystring';

    function loadKnob() {
        $('.knob').knob({

            draw: function () {

                if (this.$.data('skin') == 'tron') {

                    var a = this.angle(this.cv)  // Angle
                        ,
                        sa = this.startAngle          // Previous start angle
                        ,
                        sat = this.startAngle         // Start angle
                        ,
                        ea                            // Previous end angle
                        ,
                        eat = sat + a                 // End angle
                        ,
                        r = true

                    this.g.lineWidth = this.lineWidth

                    this.o.cursor
                        && (sat = eat - 0.3)
                        && (eat = eat + 0.3)

                    if (this.o.displayPrevious) {
                        ea = this.startAngle + this.angle(this.value)
                        this.o.cursor
                            && (sa = ea - 0.3)
                            && (ea = ea + 0.3)
                        this.g.beginPath()
                        this.g.strokeStyle = this.previousColor
                        this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false)
                        this.g.stroke()
                    }

                    this.g.beginPath()
                    this.g.strokeStyle = r ? this.o.fgColor : this.fgColor
                    this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false)
                    this.g.stroke()

                    this.g.lineWidth = 2
                    this.g.beginPath()
                    this.g.strokeStyle = this.o.fgColor
                    this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false)
                    this.g.stroke()

                    return false
                }
                $("#charts").show();
            }
        })
        $(".knob").each(function () {
            this.value = Math.round(this.getAttribute('value'));
        }).knob({

            'dynamicDraw': true,

        });
    }


    function loadSommario(date) {
        loadKnob();

        $.ajax({
            url: '/resourcerequest/ajaxSommario?selected='+date,
            type: 'get',
            success: function (data) {
                $("#bozze_rep").attr({
                    "value": data.data.bozze,
                    "data-max": data.data.totale,
                });
                $("#sent_rep").attr({
                    "value": data.data.inviata,
                    "data-max": data.data.totale,
                });
                $("#incarico_rep").attr({
                    "value": data.data.inCarico,
                    "data-max": data.data.totale,
                });
                $("#comple_rep").attr({
                    "value": data.data.completata,
                    "data-max": data.data.totale,
                });
                $('.knob').trigger('configure', {
                    max: data.data.totale
                });


                $("#totRichieste").text(data.data.totale);

                loadKnob();
                
                $('.knob').trigger('change').trigger('draw');

            }
        });
    }



    /*
     
     
     */
    //loadKnob();
    //updateTotal();
    loadSommario('@todaystring');

</script>