@model LoocERP.ViewModels.Sdi.FatturaViewModel;


<div class="modal fade" id="modal_lista_ddt" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl  modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">DDT emessi </h5>
        <p>@Model.fattura.IDCompany</p>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
                        @( Html.DevExtreme().DataGrid<LoocERP.Models.Ddt>()
                            .ID("DdtContainer")
                            .ShowBorders(true)
                            .Selection(s => s.Mode(SelectionMode.Multiple)
                                              .ShowCheckBoxesMode(GridSelectionShowCheckBoxesMode.Always))
                            //.OnSelectionChanged("selection_changed")                                              
                            .AllowColumnReordering(true)
                            .AllowColumnResizing(true)
                            .ColumnAutoWidth(true)
                            .HoverStateEnabled(true)
                            .Paging(paging => paging.PageSize(10))
                            .Pager(pager => {
                                pager.Visible(true);
                                pager.DisplayMode(GridPagerDisplayMode.Full);
                                pager.ShowPageSizeSelector(true);
                                pager.AllowedPageSizes(new JS("[5, 10, 'all']"));
                                pager.ShowInfo(true);
                                pager.ShowNavigationButtons(true);
                            })
                            .FilterRow(filterRow => filterRow
                                .Visible(true)
                                .ApplyFilter(GridApplyFilterMode.Auto)
                            )
                            .DataSource(ds => ds.Mvc()
                                .Controller("sdi")
                                .LoadAction("getDdtByFornitore")
                                // .LoadParams(new { idFornitore = @Model.fattura.IDCompany }) *@
                                .LoadParams(new { idFornitore = "FAB53D66-34D0-4661-C4EB-08D8A1D577F8" })
                                .Key("Id")
                            )
                            .RemoteOperations(true)
                            .Columns( columns => {
                                    columns.Add().DataField("NumeroProgressivoDocumento").Caption("Num. DDT").Width("10%");
                                    columns.Add().DataField("DataDDT")
                                            .Caption("Data emissione")
                                            .Format("dd/M/yyyy")
                                            .Alignment(HorizontalAlignment.Left)
                                            .DataType(GridColumnDataType.Date)
                                            ;
                                }
                            )
                            .MasterDetail(md => md
                                            .Enabled(true)
                                            .Template(@<text>
                                                <div class="master-detail-caption bg-blue rounded"><span class="ml-2 font-weight-bolder">Dettaglio DDT:</span></div>
                                                @(Html.DevExtreme().DataGrid<LoocERP.Models.DdtDettaglio>()
                                                    .DataSource(d => d.Mvc()
                                                        .Controller("sdi")
                                                        .LoadAction("DdtDetails")
                                                        .LoadParams(new { DdtId = new JS("data.Id") })
                                                    )
                                                    .ShowBorders(true)
                                                    .Columns( columns => {
                                                                columns.AddFor(m => m.Codice).Caption("Cod. articolo");
                                                                columns.AddFor(m => m.Descrizione).Caption("Descrizione");
                                                            }

                                                    )
                                                )

                                            </text>)
                            )

                        )            
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
        <button type="button" class="btn btn-primary" id="btn-associaddt">Associa</button>
      </div>
    </div>
  </div>
</div>